# Redis의 공식 이미지를 기본으로 사용
FROM redis:alpine

# 메타데이터 추가
LABEL maintainer="Crime Cat Bot Team"
LABEL description="Redis server with keyspace notifications for sleep timer functionality"
LABEL version="1.0"

# Redis 데이터 디렉토리 생성
RUN mkdir -p /data

# Redis 설정 파일을 컨테이너에 복사
COPY ./docker/redis/redis.conf /usr/local/etc/redis/redis.conf

# Redis 데이터 볼륨 설정
VOLUME ["/data"]

# Redis 기본 포트 노출
EXPOSE 6379

# 헬스체크 추가
HEALTHCHECK --interval=30s --timeout=10s --start-period=30s --retries=3 \
    CMD redis-cli ping || exit 1

# Redis 서버를 사용자 정의 설정 파일과 함께 시작
CMD ["redis-server", "/usr/local/etc/redis/redis.conf"]
